<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-DVKE6J0Z2Z"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-DVKE6J0Z2Z');
  </script>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title id="pageTitle">School Profile | FindSchool.uk</title>
  <meta id="metaDescription" name="description" content="Explore UK school performance with FindSchool.uk. Compare Ofsted ratings, inspection history, curriculum and parent reviews."/>
  <meta name="robots" content="index,follow"/>
  <meta name="author" content="FindSchool.uk"/>
  <link rel="canonical" href="https://www.findschool.uk/school" id="canonicalLink"/>
  <link rel="alternate" href="https://www.findschool.uk/school" hreflang="en-gb" id="alternateLink"/>
  <meta name="referrer" content="strict-origin-when-cross-origin"/>
  <meta name="theme-color" content="#2563eb"/>
  <meta property="og:site_name" content="FindSchool.uk"/>
  <meta property="og:type" content="school"/>
  <meta property="og:title" content="School Profile | FindSchool.uk" id="ogTitle"/>
  <meta property="og:description" content="Discover detailed UK school profiles with FindSchool.uk including Ofsted reports, performance and community insights." id="ogDescription"/>
  <meta property="og:url" content="https://www.findschool.uk/school" id="ogUrl"/>
  <meta property="og:image" content="https://www.findschool.uk/images/findschool-social.png"/>
  <meta property="og:image:alt" content="FindSchool.uk social preview card"/>
  <meta property="og:locale" content="en_GB"/>
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="School Profile | FindSchool.uk" id="twitterTitle"/>
  <meta name="twitter:description" content="In-depth profiles for every UK school on FindSchool.uk." id="twitterDescription"/>
  <meta name="twitter:image" content="https://www.findschool.uk/images/findschool-social.png"/>
  <meta name="twitter:image:alt" content="FindSchool.uk social preview card"/>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

  <!-- Leaflet CSS and JS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <!-- Main CSS -->
  <link rel="stylesheet" href="/css/styles.css">
  <link rel="stylesheet" href="/css/school-profile.css">
  <script type="application/ld+json" id="structuredData">
    {}
  </script>
</head>
<body>
  <!-- Header component -->
  <div id="header"></div>

  <!-- Breadcrumb -->
  <div class="breadcrumb">
    <div class="container">
      <ol class="breadcrumb-list">
        <li class="breadcrumb-item"><a href="/">Home</a></li>
        <li class="breadcrumb-separator">/</li>
        <li class="breadcrumb-item"><a href="#" id="cityCrumb">City</a></li>
        <li class="breadcrumb-separator">/</li>
        <li class="breadcrumb-item"><a href="#" id="laCrumb">Local Authority</a></li>
        <li class="breadcrumb-separator">/</li>
        <li class="breadcrumb-item active" id="schoolCrumb">School Name</li>
      </ol>
    </div>
  </div>

  <!-- School Header component -->
  <div id="schoolHeaderSection"></div>

  <!-- Key Stats component -->
  <div id="schoolStatsSection"></div>

  <section class="container" style="margin-top:2rem;">
    <div class="profile-content">
      <div class="main-content">
        <!-- School Rating section -->
        <div id="schoolRatingSection"></div>

        <!-- Test Scores section -->
        <div id="schoolTestScoresSection"></div>

        <!-- School Info component -->
        <div id="schoolInfoSection"></div>
        
        <!-- Demographics section -->
        <div id="schooldemographics"></div>

        <!-- Ofsted component -->
        <div id="schoolOfstedSection"></div>

        <!-- Reviews section -->
        <div id="schoolReviewsSection"></div>

        <!-- Contact & Location component -->
        <div id="schoolContactSection"></div>

        <div id="schoolSidebarSection"></div>
      </div>

      <!-- Sidebar component -->
      
    </div>
  </section>

  <!-- Footer component -->
  <div id="footer" style="margin-top:4rem;"></div>

  <!-- Load scripts -->
  <script src="/js/main.js"></script>
  <script src="/js/school.js"></script>
  
  <script>
  async function loadComponent(componentName, targetId) {
    try {
      const res = await fetch(`/components/${componentName}.html`);
      if (!res.ok) {
        console.error(`Failed to load ${componentName}:`, res.status);
        return;
      }

      const html = await res.text();
      const target = document.getElementById(targetId);
      if (!target) {
        console.error(`Target element ${targetId} not found`);
        return;
      }

      // 1) Inject HTML
      target.innerHTML = html;

      if (componentName === 'header' && typeof window.initializeHeader === 'function') {
        window.initializeHeader();
      }

      // 2) Execute any <script> tags from the injected fragment
      const scripts = Array.from(target.querySelectorAll('script'));
      for (const old of scripts) {
        const s = document.createElement('script');
        // preserve inline vs external scripts
        if (old.src) s.src = old.src;
        if (old.type) s.type = old.type;
        if (old.noModule) s.noModule = true;
        if (old.defer) s.defer = true;
        if (!old.src) s.textContent = old.textContent;
        // execute by adding to DOM
        document.body.appendChild(s);
        // remove the original to avoid duplicates
        old.parentNode.removeChild(old);
      }
    } catch (e) {
      console.error(`Error loading ${componentName}:`, e);
    }
  }

  // Load all components
  async function loadAllComponents() {
    const components = [
      { name: 'header', target: 'header' },
      { name: 'footer', target: 'footer' },
      { name: 'school-header', target: 'schoolHeaderSection' },
      { name: 'school-stats', target: 'schoolStatsSection' },
      { name: 'school-rating', target: 'schoolRatingSection' },
      { name: 'school-test-scores', target: 'schoolTestScoresSection' },
      { name: 'school-info', target: 'schoolInfoSection' },
      { name: 'school-ofsted', target: 'schoolOfstedSection' },
      { name: 'school-demographics', target: 'schooldemographics' },
      { name: 'school-reviews', target: 'schoolReviewsSection' },
      { name: 'school-contact', target: 'schoolContactSection' },
      { name: 'school-sidebar', target: 'schoolSidebarSection' }
    ];

    // Load components in parallel
    const promises = components.map(comp => 
      loadComponent(comp.name, comp.target)
    );

    await Promise.all(promises);
    document.dispatchEvent(new Event('componentsLoaded'));

    // âœ… If data was fetched earlier, render every section now
    if (window.renderSchoolUIFromCache) {
      window.renderSchoolUIFromCache();
    }

    
    // Give components time to initialize, then check if rating needs update
    setTimeout(() => {
      if (window.currentSchoolData && typeof window.updateRatingDisplay === 'function') {
        console.log('Updating rating display after component load');
        window.updateRatingDisplay(window.currentSchoolData);
      }
    }, 500);
  }

  // Initialize when DOM is ready
  document.addEventListener('DOMContentLoaded', function() {
    loadAllComponents();
  });
  </script>
</body>
</html>
